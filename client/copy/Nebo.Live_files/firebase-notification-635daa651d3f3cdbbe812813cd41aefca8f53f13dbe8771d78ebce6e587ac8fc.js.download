function getToken(){messaging.requestPermission().then(function(){messaging.getToken().then(function(e){e?(sendTokenToServer(e),updateUIForPushEnabled(e)):(showError("No Instance ID token available. Request permission to generate one."),updateUIForPushPermissionRequired(),setTokenSentToServer(!1))})["catch"](function(e){showError("An error occurred while retrieving token.",e),updateUIForPushPermissionRequired(),setTokenSentToServer(!1)})})["catch"](function(e){showError("Unable to get permission to notify.",e)})}function sendTokenToServer(e){isTokenSentToServer(e)?console.log("Token already sent to server so won't send it again unless it changes"):(console.log("Sending token to server..."),$.ajax({type:"POST",url:"/api/v1/clients/",data:JSON.stringify({client:{firebase:e}})}).done(function(){setTokenSentToServer(e)}))}function deleteTokenFromServer(e){$.ajax({type:"DELETE",url:"/api/v1/clients/"+e})}function isTokenSentToServer(e){return window.localStorage.getItem("sentFirebaseMessagingToken")==e}function setTokenSentToServer(e){e?window.localStorage.setItem("sentFirebaseMessagingToken",e):window.localStorage.removeItem("sentFirebaseMessagingToken")}function updateUIForPushEnabled(e){console.log(e),bt_register.hide(),bt_delete.show(),bt_settings.show()}function resetUI(){bt_register.show(),bt_delete.hide(),bt_settings.hide(),massage_row.hide(),info.hide()}function updateUIForPushPermissionRequired(){bt_register.attr("disabled","disabled"),resetUI()}function showError(e,o){void 0!==o?console.error(e+" ",o):console.error(e),alert.show(),alert_message.html(e)}firebase.initializeApp({messagingSenderId:"1001903122936"});var bt_register=$("#register-notifications"),bt_delete=$("#delete-notifications"),bt_settings=$("#settings-notifications"),token=$("#token"),massage_id=$("#massage_id"),massage_row=$("#massage_row"),info=$("#info"),info_message=$("#info-message"),alert=$("#alert"),alert_message=$("#alert-message"),input_body=$("#body");if(resetUI(),"Notification"in window&&"serviceWorker"in navigator&&"localStorage"in window&&"fetch"in window&&"postMessage"in window){var messaging=firebase.messaging();"granted"===Notification.permission&&getToken(),bt_register.on("click",function(){getToken()}),bt_delete.on("click",function(){messaging.getToken().then(function(e){messaging.deleteToken(e).then(function(){console.log("Token deleted."),deleteTokenFromServer(e),setTokenSentToServer(!1),resetUI()})["catch"](function(e){showError("Unable to delete token.",e)})})["catch"](function(e){showError("Error retrieving Instance ID token.",e)})}),messaging.onMessage(function(e){console.log("Message received. ",e),info.show(),info_message.text("").append("<strong>"+e.notification.title+"</strong>").append("<em> "+e.notification.body+"</em>"),navigator.serviceWorker.register("/assets/firebase/messaging-sw-ee547442d4f1652973bb362e792c548b0307aab19850ba1ebdaa7f7202c416f8.js"),Notification.requestPermission(function(o){"granted"===o&&navigator.serviceWorker.ready.then(function(o){e.notification.data=e.notification,o.showNotification(e.notification.title,e.notification)})["catch"](function(e){showError("ServiceWorker registration failed.",e)})})}),messaging.onTokenRefresh(function(){messaging.getToken().then(function(e){console.log("Token refreshed."),sendTokenToServer(e),updateUIForPushEnabled(e)})["catch"](function(e){showError("Unable to retrieve refreshed token.",e)})})}else"https:"!==window.location.protocol?showError("Is not from HTTPS"):"Notification"in window?"serviceWorker"in navigator?"localStorage"in window?"fetch"in window?"postMessage"in window||showError("postMessage not supported"):showError("fetch not supported"):showError("LocalStorage not supported"):showError("ServiceWorker not supported"):showError("Notification not supported"),console.warn("This browser does not support desktop notification."),console.log("Is HTTPS","https:"===window.location.protocol),console.log("Support Notification","Notification"in window),console.log("Support ServiceWorker","serviceWorker"in navigator),console.log("Support LocalStorage","localStorage"in window),console.log("Support fetch","fetch"in window),console.log("Support postMessage","postMessage"in window),updateUIForPushPermissionRequired();